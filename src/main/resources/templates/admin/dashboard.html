<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/admin_layout}">
<head>
  <title>Admin Dashboard</title>
</head>
<body>

<!-- Toàn bộ nội dung trang, bao gồm cả script, nằm trong fragment này -->
<section layout:fragment="content">
  <h1 class="mb-4">Admin Dashboard</h1>

  <!-- Thẻ thống kê -->
  <div class="row" th:if="${stats != null}">
    <div class="col-md-3">
      <div class="card"><div class="card-body">
        <h5 class="card-title">TOTAL USERS</h5>
        <p class="card-text fs-4" th:text="${stats.totalUsers}">5</p>
      </div></div>
    </div>
    <div class="col-md-3">
      <div class="card"><div class="card-body">
        <h5 class="card-title">TOTAL PRODUCTS</h5>
        <p class="card-text fs-4" th:text="${stats.totalProducts}">9</p>
      </div></div>
    </div>
    <div class="col-md-3">
      <div class="card"><div class="card-body">
        <h5 class="card-title">TOTAL ORDERS</h5>
        <p class="card-text fs-4" th:text="${stats.totalOrders}">13</p>
      </div></div>
    </div>
    <div class="col-md-3">
      <div class="card"><div class="card-body">
        <h5 class="card-title">TOTAL REVENUE (DELIVERED)</h5>
        <p class="card-text fs-4" th:text="'$' + ${#numbers.formatDecimal(stats.totalRevenue, 1, 'COMMA', 2, 'POINT')}">$573.97</p>
      </div></div>
    </div>
  </div>

  <!-- Biểu đồ doanh thu -->
  <div class="card mt-4">
    <div class="card-header">
      Monthly Revenue Chart (Current Year)
    </div>
    <div class="card-body">
      <canvas id="monthlyRevenueChart"></canvas>
    </div>
  </div>

  <!-- ===== ĐOẠN SCRIPT ĐƯỢC DI CHUYỂN VÀO ĐÂY ===== -->
  <script th:inline="javascript">
    /*<![CDATA[*/
    // Mã JavaScript nằm trong CDATA để tránh các vấn đề về parsing của XML/HTML
    document.addEventListener("DOMContentLoaded", function() {
      // Lấy thẻ canvas
      const ctx = document.getElementById('monthlyRevenueChart');

      // Kiểm tra xem canvas có tồn tại không
      if (ctx) {
        fetch('/admin/api/chart-data')
                .then(response => response.json())
                .then(chartData => {
                  new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                      labels: chartData.labels,
                      datasets: [{
                        label: 'Revenue ($)',
                        data: chartData.data,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgb(54, 162, 235)',
                        borderWidth: 1
                      }]
                    },
                    options: {
                      scales: {
                        y: {
                          beginAtZero: true,
                          ticks: {
                            callback: function(value) {
                              return '$' + value.toLocaleString();
                            }
                          }
                        }
                      }
                    }
                  });
                })
                .catch(error => console.error('Error fetching or rendering chart:', error));
      }
    });
    /*]]>*/
  </script>
</section>

</body>
</html>